name: Playwright Tests (Docker)

on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:

jobs:
  test-docker:
    timeout-minutes: 60
    runs-on: blacksmith-8vcpu-ubuntu-2404

    steps:
    - uses: actions/checkout@v4

    - name: Build Docker image
      run: docker build -t chroma-test .

    - name: Run Playwright tests
      run: |
        docker run --rm --shm-size=2gb \
          -v ${{ github.workspace }}/tests/e2e-polkadot-js/playwright-report:/app/tests/e2e-polkadot-js/playwright-report \
          -v ${{ github.workspace }}/tests/e2e-polkadot-js/test-results:/app/tests/e2e-polkadot-js/test-results \
          chroma-test

    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: playwright-report-docker
        path: tests/e2e-polkadot-js/playwright-report/
        retention-days: 30

    - uses: actions/upload-artifact@v4
      if: failure()
      with:
        name: playwright-test-results-docker
        path: tests/e2e-polkadot-js/test-results/
        retention-days: 30
